{"version":3,"sources":["../../../../graphql/schema/user/_model.js"],"names":["Object","defineProperty","exports","value","default","_mongoose","_interopRequireDefault","require","_crypto","_jsonwebtoken","obj","__esModule","jwtSecret","process","env","JWT_SECRET","userSchema","Schema","email","type","String","required","sparse","unique","hash","salt","role","enum","created_at","Date","updated_at","pre","save","next","currentDate","method","setPassword","password","randomBytes","toString","pbkdf2Sync","validatePassword","generateJWT","today","expirationDate","setDate","getDate","sign","id","_id","exp","parseInt","getTime","toAuthJSON","user","toGraph","token","set","virtuals","JSON","parse","stringify","_default","model"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _mongoose = _interopRequireDefault(require(\"mongoose\"));\n\nvar _crypto = _interopRequireDefault(require(\"crypto\"));\n\nvar _jsonwebtoken = _interopRequireDefault(require(\"jsonwebtoken\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst jwtSecret = process.env.JWT_SECRET;\nconst userSchema = new _mongoose.default.Schema({\n  email: {\n    type: String,\n    required: true,\n    sparse: true,\n    unique: true\n  },\n  hash: String,\n  salt: String,\n  role: {\n    type: String,\n    enum: ['USER', 'ADMIN'],\n    default: 'USER'\n  },\n  created_at: {\n    type: Date,\n    default: new Date()\n  },\n  updated_at: {\n    type: Date,\n    default: new Date()\n  }\n});\nuserSchema.pre('save', function save(next) {\n  // get the current date\n  const currentDate = new Date(); // change the updated_at field to current date\n\n  this.updated_at = currentDate; // if created_at doesn't exist, add to that field\n\n  if (!this.created_at) this.created_at = currentDate;\n  next();\n});\nuserSchema.method('setPassword', function setPassword(password) {\n  this.salt = _crypto.default.randomBytes(16).toString('hex');\n  this.hash = _crypto.default.pbkdf2Sync(password, this.salt, 10000, 512, 'sha512').toString('hex');\n});\nuserSchema.method('validatePassword', function validatePassword(password) {\n  const hash = _crypto.default.pbkdf2Sync(password, this.salt, 10000, 512, 'sha512').toString('hex');\n\n  return this.hash === hash;\n});\nuserSchema.method('generateJWT', function generateJWT() {\n  const today = new Date();\n  const expirationDate = new Date(today);\n  expirationDate.setDate(today.getDate() + 60);\n  return _jsonwebtoken.default.sign({\n    email: this.email,\n    id: this._id,\n    exp: parseInt(expirationDate.getTime() / 1000, 10)\n  }, jwtSecret);\n});\nuserSchema.method('toAuthJSON', function toAuthJSON() {\n  return {\n    user: this.toGraph(),\n    token: this.generateJWT()\n  };\n});\n/**\n * This property will ensure our virtuals (including \"id\")\n * are set on the user when we use it.\n */\n\nuserSchema.set('toObject', {\n  virtuals: true\n});\n/**\n * Used for returning user object to graphql\n */\n\nuserSchema.method('toGraph', function toGraph() {\n  return JSON.parse(JSON.stringify(this));\n});\n\nvar _default = _mongoose.default.model('User', userSchema);\n\nexports.default = _default;"],"file":"_model.js"}